LIB.namespace("ADLIB.deliverylocation"),function(n){"use strict";function r(n){new Spinner({color:"#3a3a3a",radius:4,length:4,width:2,lines:9}).spin(n)}function f(t){var i=n(".delivery-location-section"),r=n(t).find(".delivery-location-section").children();i.html(r)}function e(t){var i=n(t).find(".selected-delivery-location");return{address:i.data("address"),name:i.data("name"),ort:i.data("ort"),rank:i.data("rank"),utls:i.data("utls"),offset:i.data("offset"),type:i.data("type"),hasLocation:i.data("address")!==null}}function i(n){ADLIB.cart.setDeliveryLocation(n.data("address"),n.data("name"),n.data("ort"),n.data("rank"),n.data("utls"),n.data("offset"),n.data("type"));ADLIB.cart.submit()}function o(){var f=n("#delivery-location"),t=n(".delivery-location-section"),o=f.attr("action"),s=f.attr("method"),i=n("#zip"),u=i.val();u!==""?(ADLIB.cart.setSelectedZip(u),r(t.find(".spinner")[0]),LIB.ajax.partial(o,{dataType:"html",data:{zip:u},type:s,cache:!1}).done(function(n){t.html(n);var i=new e(n);i.hasLocation&&(ADLIB.cart.setDeliveryLocation(i.address,i.name,i.ort,i.rank,i.utls,i.offset,i.type),ADLIB.cart.submit())}).fail(function(){t.find(".error-text").show();i.focus()})):i.focus()}function u(){var u=n("#delivery-locations"),t=n(".js-change-delivery-location .light-box"),f=n(".selected-delivery-location"),e=u.attr("action"),o=u.attr("method"),s=n(".js-confirm-delivery-location"),i=n("#zip").val();i!==undefined&&i!==""&&(r(t.find(".spinner")[0]),ADLIB.cart.setSelectedZip(i),LIB.ajax.partial(e,{dataType:"html",data:{zip:i},type:o,cache:!1}).done(function(i){t.html(i);t.find("[data-utls="+f.data("utls")+"]").length===0?n(".check-radio-item").first().addClass("selected"):t.find("[data-utls="+f.data("utls")+"]").addClass("selected");LIB.mediaQuery.isNarrowerThan("narrow-tablet")&&window.scrollTo(0,n(".delivery-location-section").first().offset().top)}).fail(function(){t.find(".error-text").show();s.hide()}))}var t=n("body");t.on("submit","#delivery-location",function(n){n.preventDefault();o()});t.on("submit","#delivery-locations",function(n){n.preventDefault();u()});t.on("click",".js-toggle-delivery-location",function(t){t.preventDefault();n("#zip").val(n("#Cart_SelectedZip").val());n(".delivery-list").html("");u();n(".js-change-delivery-location").addClass("show")});t.on("click",".js-close-delivery-lightbox, .js-change-delivery-location .light-layer ",function(t){t.preventDefault();n(".js-change-delivery-location").removeClass("show");i(n(".js-change-delivery-location").find(".js-select-delivery-location.selected"))});t.on("click",".js-select-delivery-location",function(t){t.preventDefault();n(".js-change-delivery-location").find(".js-select-delivery-location").removeClass("selected");n(".js-change-delivery-location").find(".js-cutoff-message").remove();n(this).addClass("selected");n(".js-is-cutoff-or-not").val()!=="False"&&n(this).attr("data-name")!=="Posten"&&n(this).append('<span class="js-cutoff-message" style="color:red; display: block;">(+1-2 vardagar)<\/span>');n(".js-toggle-delivery-locations-mobile").is(":visible")&&i(n(".js-change-delivery-location").find(".js-select-delivery-location.selected"))});t.on("click",".js-show-more-delivery-locations",function(t){t.preventDefault();n(".js-show-more-items").addClass("delivery-list--show-all")});t.on("click",".js-confirm-delivery-location",function(t){t.preventDefault();n(".js-change-delivery-location").removeClass("show");i(n(".js-change-delivery-location").find(".js-select-delivery-location.selected"))});ADLIB.deliverylocation={redraw:f}}(jQuery)